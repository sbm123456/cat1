import{defineComponent as D,ref as w,watch as B,resolveComponent as _,openBlock as i,createBlock as a,withCtx as d,Fragment as m,createVNode as n,toDisplayString as f,unref as t,createCommentVNode as F,createTextVNode as p}from"../vue.js";import{useRouter as E}from"../vue-router.js";import{config as o,receive as V,user as b,send as C,sha256 as $}from"../client.js";const A=n("h1",null,[n("span",null,"\u5E73\u53F0\u8D26\u6237\u767B\u5F55")],-1),T={class:"hint"},P=n("p",{class:"hint"},"\u8BF7\u7528\u4E0A\u8FF0\u8D26\u53F7\u5C06\u4E0B\u9762\u7684\u9A8C\u8BC1\u7801\u79C1\u804A\u53D1\u9001\u7ED9\u4EFB\u610F\u673A\u5668\u4EBA",-1),j={class:"token"},U={class:"control"},I=p("\u8FD4\u56DE\u4E0A\u4E00\u6B65"),N={key:0},S=p(" / "),R={key:1},z=n("span",null,"\u5E73\u53F0\u8D26\u6237\u767B\u5F55",-1),K={key:0,class:"error"},q={class:"control"},G=p("\u8FD4\u56DE"),H=p("\u83B7\u53D6\u9A8C\u8BC1\u7801"),J={key:0,class:"error"},L={class:"control"},M=p("\u8FD4\u56DE"),O=p("\u767B\u5F55");var Q=D({setup(W){const k=isSecureContext;k||(o.value.authType=0);const l=w({}),v=E();V("login",s=>l.value=s),B(b,s=>{var e;!s||v.push(((e=v.currentRoute.value.redirectedFrom)==null?void 0:e.fullPath)||"/profile")});let h=0;async function g(){const s=Date.now();if(s<h)return;const{platform:e,userId:r}=o.value;!e||!r||(h=s+1e3,C("token",{platform:e,userId:r}))}async function y(){const{username:s,password:e}=o.value;C("login",{username:s,password:await $(e)})}return(s,e)=>{const r=_("k-button"),c=_("k-input"),x=_("k-card");return i(),a(x,{class:"login"},{default:d(()=>[l.value.token?(i(),a(m,{key:0},[A,n("p",T,"\u6B22\u8FCE\u4F60\uFF0C"+f(l.value.name||"Koishi \u7528\u6237")+"\uFF01",1),P,n("p",j,f(l.value.token),1),n("div",U,[n(r,{onClick:e[1]||(e[1]=u=>l.value.token=null)},{default:d(()=>[I]),_:1})])],64)):(i(),a(m,{key:1},[t(k)?(i(),a("h1",N,[n("span",{class:{inactive:t(o).authType===1},onClick:e[2]||(e[2]=u=>t(o).authType=0)},"\u5E73\u53F0\u8D26\u6237\u767B\u5F55",2),S,n("span",{class:{inactive:t(o).authType===0},onClick:e[3]||(e[3]=u=>t(o).authType=1)},"\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55",2)])):(i(),a("h1",R,[z])),t(o).authType===0?(i(),a(m,{key:2},[n(c,{prefix:"at",placeholder:"\u5E73\u53F0\u540D",modelValue:t(o).platform,"onUpdate:modelValue":e[4]||(e[4]=u=>t(o).platform=u)},null,8,["modelValue"]),n(c,{prefix:"user",placeholder:"\u8D26\u53F7",modelValue:t(o).userId,"onUpdate:modelValue":e[5]||(e[5]=u=>t(o).userId=u),onEnter:g},null,8,["modelValue"]),l.value.message?(i(),a("p",K,f(l.value.message),1)):F("v-if",!0),n("div",q,[n(r,{onClick:e[6]||(e[6]=u=>s.$router.back())},{default:d(()=>[G]),_:1}),n(r,{onClick:g},{default:d(()=>[H]),_:1})])],64)):(i(),a(m,{key:3},[n(c,{prefix:"user",placeholder:"\u7528\u6237\u540D",modelValue:t(o).username,"onUpdate:modelValue":e[7]||(e[7]=u=>t(o).username=u)},null,8,["modelValue"]),n(c,{prefix:"lock",placeholder:"\u5BC6\u7801",modelValue:t(o).password,"onUpdate:modelValue":e[8]||(e[8]=u=>t(o).password=u),onEnter:y,type:t(o).showPass?"text":"password",suffix:t(o).showPass?"eye":"eye-slash",onClickSuffix:e[9]||(e[9]=u=>t(o).showPass=!t(o).showPass)},null,8,["modelValue","type","suffix"]),l.value.message?(i(),a("p",J,f(l.value.message),1)):F("v-if",!0),n("div",L,[n(r,{onClick:e[10]||(e[10]=u=>s.$router.back())},{default:d(()=>[M]),_:1}),n(r,{onClick:y},{default:d(()=>[O]),_:1})])],64))],64))]),_:1})}}}),ee=`section.login {
  max-width: 600px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin-bottom: 0 !important;
}
section.login .k-card-body {
  padding: 3rem 0 !important;
}
section.login h1 {
  font-size: 1.5rem;
  margin: 2.5rem auto;
  cursor: default;
}
section.login h1 span {
  transition: 0.3s ease;
}
section.login h1 span.inactive:hover {
  cursor: pointer;
  color: rgba(244, 244, 245, 0.8);
}
section.login h1 span:not(.inactive) {
  color: #f4f4f5;
}
section.login .token {
  font-weight: bold;
}
section.login .k-input {
  display: block;
  max-width: 400px;
  margin: 1rem auto;
}
section.login .control {
  margin: 2.5rem auto;
}
section.login .k-button {
  width: 8rem;
  margin: 0 1rem;
}`;export default Q;
